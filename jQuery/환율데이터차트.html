<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
    <!-- CDN -->
</head>

<body>
    <div id="id_disp"></div>
    
    <input type=button value="차트에 속으면 돈 잃는다" onclick="f_chg()">
    <!-- canvas : 그림을 그려줌 -->
    <div style="width: 800px; height: 600px;">
        <canvas id="myChart"></canvas>
    </div>
    <script>
        $("#id_btn").on("click", function() {
        if(localStorage.getItem("April")) {
            alert("데이터가 이미 있으니, 캐쉬된 걸 사용해 주세요 감사!");
            return;
        }

        $.ajax({
            type:"get",
            url:"https://api.exchangerate.host/timeseries",
            data: "base=USD&places=2&start_date=2020-04-01&end_date=2020-04-15",
            success:function(p_rslt) {
                // console.log(p_rslt);
                var v_dataArr = []; // 빈배열
                    for (const v_data in v_rates) {
                        var v_jdata = {};
                        v_jdata.date = v_data;
                        v_jdata.KRW = v_rates[v_data].KRW;
                        v_jdata.JPY = v_rates[v_data]["JPY"];
                        v_dataArr.push(v_jdata);    // 만든 json 배열에 넣기
                    }

                    /* v_dataArr을 날짜 역순으로 정렬하시오 */

                    v_dataArr.sort(function(a, b){
                        return b.date.replaceAll("-","") - a.date.replaceAll("-","");
                    }); // 배열 확인

                    localStorage["April"] = JSON.stringify(v_dataArr);
                }
            });
        });

/* 값 대역대를 비슷하게 맞춤 */
/* 원화 엔화의 변화율 , 흐름을 보기 위함 */
        function f_chg() {
            var v_chartdata = JSON.parse(localStorage.getItem("April"));

            for (var v_data in v_chartdata) {
                var v_date = v_chartdata[v_data].date;
                var v_dateKRW = v_chartdata[v_data].KRW;
                var v_dateJPY = v_chartdata[v_data].JPY;

                myChart.data.labels.push(v_date);
                myChart.data.datasets[0].data.push(v_dateKRW);
                myChart.data.datasets[0].backgroundColor.push("rgb(134,23,134,0.2");
                myChart.data.datasets[0].borderColor.push("rgb(14,23,14,");

                myChart.data.datasets[1].data.push(v_dateJPY *10);
                myChart.data.datasets[1].backgroundColor.push("rgb(234,123,234,0.2");
                myChart.data.datasets[1].borderColor.push("rgb(314,283,14,");
            }
            myChart.update();
            
        }

        var ctx = document.getElementById('myChart').getContext('2d');
       /* 차트의 속성은 JSON으로 줌 */
        var myChart = new Chart(ctx, {
            type: 'bar',    /* 차트모양 bar, line, pie, doughnut, radar */
            data: {
                labels: [],
                datasets: [{
                    label: '# KRW',
                    data: [],
                    backgroundColor: [
                        
                    ],
                    borderColor: [
                        
                    ],
                },
                {
                    label: '# JPY',
                    data: [],
                    backgroundColor: [
                        
                    ],
                    borderColor: [
                        
                    ],
                }
                ]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            /* 차트 y축 값 0부터 시작하는지  */
                            beginAtZero: false
                        }
                    }]
                }
            }
        });

    </script>
</body>
</html>